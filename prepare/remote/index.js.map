"{\"version\":3,\"sources\":[\"/webpack/bootstrap\",\"../src/prepare/setup/MonitorTools/Netdata.ts\",\"../src/prepare/setup/Timezone.ts\",\"../src/prepare/setup/Nginx.ts\",\"../src/prepare/setup/MonitorTools/Journalbeat.ts\",\"../src/prepare/index.ts\",\"../external \\\"child_process\\\"\",\"../external \\\"https\\\"\",\"../src/prepare/setup/MonitoringTools.ts\",\"../src/prepare/setup/MonitorTools/FailureNotificationServices.ts\",\"../src/prepare/setup/aptDependencies.ts\",\"../src/prepare/setup/MonitorTools/PersistentJournal.ts\",\"../src/utils/readSecrets.ts\",\"../src/utils/printOSInfo.ts\",\"../src/utils/spawn.ts\",\"../src/prepare/setup/Security.ts\",\"../src/prepare/setup/basicServer.ts\",\"../src/prepare/setup/DeveloperTools.ts\",\"../src/prepare/setup/MainServiceFiles.ts\",\"../src/utils/request.ts\",\"../external \\\"path\\\"\",\"../external \\\"util\\\"\",\"../src/utils/readAvenConfig.ts\",\"../src/prepare/setup/Root.ts\",\"../external \\\"fs\\\"\",\"../src/utils/Files.ts\",\"../src/utils/User.ts\",\"../src/prepare/setup/MonitorTools/Cockpit.ts\",\"/webpack/runtime/node module decorator\"],\"names\":[\"installedModules\",\"__webpack_require__\",\"moduleId\",\"exports\",\"module\",\"i\",\"l\",\"modules\",\"call\",\"ab\",\"__dirname\",\"startup\",\"runtime\",\"__awaiter\",\"this\",\"thisArg\",\"_arguments\",\"P\",\"generator\",\"adopt\",\"value\",\"resolve\",\"Promise\",\"reject\",\"fulfilled\",\"step\",\"next\",\"e\",\"rejected\",\"result\",\"done\",\"then\",\"apply\",\"Object\",\"defineProperty\",\"spawn_1\",\"setupNetdata\",\"installScriptStable\",\"exec\",\"Files_1\",\"readAvenConfig_1\",\"setupTimezone\",\"timezone\",\"readAvenConfig\",\"path\",\"ensureLinkIs\",\"fs_1\",\"aptDependencies_1\",\"mkdir\",\"chmod\",\"promises\",\"addAptDependencies\",\"certbotWebrootPath\",\"letsencryptLive\",\"nginxConf\",\"setupNginxSnips\",\"dir\",\"recursive\",\"snips\",\"letsencrypt\",\"all\",\"ensureFilesAre\",\"entries\",\"map\",\"config\",\"contents\",\"filename\",\"setupNginxConfigs\",\"domains\",\"conf\",\"basic\",\"gzip\",\"logging\",\"validForwardedHeaderPattern\",\"servers\",\"ssl\",\"setupNginxBasicServers\",\"serverConfigDefault\",\"ensureFileIs\",\"setupNginxServersFull\",\"rootPath\",\"serviceName\",\"upstreamUniqueName\",\"replace\",\"socketFilename\",\"workingDir\",\"upstreamHost\",\"serverConfig\",\"join\",\"nginxConfigFile\",\"setupNginxBasic\",\"certbotCliConfig\",\"certbotPostRenewNginx\",\"setupCertbot\",\"outputFile\",\"certbotPostRenewExampleFullChain\",\"spawn\",\"reduce\",\"res\",\"current\",\"concat\",\"hook\",\"checkNginxConfig\",\"setupNginx\",\"setupJournalbeat\",\"journalbeat\",\"journalbeatConfig\",\"kibanaHost\",\"elastic\",\"JSON\",\"stringify\",\"hosts\",\"username\",\"password\",\"logstashHosts\",\"change\",\"Nginx_1\",\"MainServiceFiles_1\",\"MonitoringTools_1\",\"DeveloperTools_1\",\"basicServer_1\",\"printOSInfo_1\",\"prepare\",\"printOSInfo\",\"basicServerSetup\",\"setupMonitoringTools\",\"setupDevTools\",\"setupMainServiceFiles\",\"console\",\"log\",\"parent\",\"catch\",\"process\",\"exitCode\",\"require\",\"Journalbeat_1\",\"Netdata_1\",\"Cockpit_1\",\"FailureNotificationServices_1\",\"PersistentJournal_1\",\"setupCockpit\",\"setupFailureNotificationService\",\"setupPersistentJournal\",\"deps\",\"dependencies\",\"push\",\"setupAptDependencies\",\"stdio\",\"env\",\"DEBIAN_FRONTEND\",\"readFile\",\"secrets\",\"readAvenSecrets\",\"undefined\",\"parse\",\"toString\",\"release\",\"osVersion\",\"split\",\"child_process_1\",\"util_1\",\"defaultShell\",\"command\",\"first\",\"args\",\"defOpts\",\"proc\",\"assign\",\"shell\",\"ret\",\"on\",\"Error\",\"child\",\"execP\",\"promisify\",\"setupSecurity\",\"changed\",\"ensureFileContains\",\"Timezone_1\",\"Security_1\",\"Root_1\",\"screenConfig\",\"setupRoot\",\"_a\",\"_b\",\"serviceDescription\",\"serviceFile\",\"serviceFileContents\",\"https_1\",\"request\",\"httpsUrl\",\"response\",\"req\",\"get\",\"chunk\",\"end\",\"Array\",\"isArray\",\"length\",\"request_1\",\"User_1\",\"path_1\",\"readSecrets_1\",\"fixAuthorizedKeys\",\"user\",\"keySources\",\"userDir\",\"userHome\",\"sshConfDir\",\"deployPublicKey\",\"url\",\"keys\",\"allKeys\",\"sources\",\"fixKnownHosts\",\"writeFile\",\"symlink\",\"readlink\",\"unlink\",\"includes\",\"list\",\"target\",\"code\",\"userGroups\",\"UsernameInUseUserAddExitValue\",\"name\",\"createAndConfigureUser\",\"home\",\"ensureKey\",\"key\",\"GitHubKnownHosts\",\"nmd\",\"paths\",\"children\",\"enumerable\"],\"mappings\":\"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\",\"file\":\"index.js\",\"sourcesContent\":[\" \\t// The module cache\\n \\tvar installedModules = {};\\n\\n \\t// The require function\\n \\tfunction __webpack_require__(moduleId) {\\n\\n \\t\\t// Check if module is in cache\\n \\t\\tif(installedModules[moduleId]) {\\n \\t\\t\\treturn installedModules[moduleId].exports;\\n \\t\\t}\\n \\t\\t// Create a new module (and put it into the cache)\\n \\t\\tvar module = installedModules[moduleId] = {\\n \\t\\t\\ti: moduleId,\\n \\t\\t\\tl: false,\\n \\t\\t\\texports: {}\\n \\t\\t};\\n\\n \\t\\t// Execute the module function\\n \\t\\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\\n\\n \\t\\t// Flag the module as loaded\\n \\t\\tmodule.l = true;\\n\\n \\t\\t// Return the exports of the module\\n \\t\\treturn module.exports;\\n \\t}\\n\\n\\n \\t__webpack_require__.ab = __dirname + \\\"/\\\";\\n\\n \\t// the startup function\\n \\tfunction startup() {\\n \\t\\t// Load entry module and return exports\\n \\t\\treturn __webpack_require__(96);\\n \\t};\\n \\t// initialize runtime\\n \\truntime(__webpack_require__);\\n\\n \\t// run startup\\n \\treturn startup();\\n\",\"\\\"use strict\\\";\\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\\n    return new (P || (P = Promise))(function (resolve, reject) {\\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\\n        function rejected(value) { try { step(generator[\\\"throw\\\"](value)); } catch (e) { reject(e); } }\\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\\n    });\\n};\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nconst spawn_1 = require(\\\"../../../utils/spawn\\\");\\nfunction setupNetdata() {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        // Nightly is recommended by Netdata https://docs.netdata.cloud/packaging/installer/#nightly-vs-stable-releases\\n        // const installScriptNightly = 'https://my-netdata.io/kickstart.sh';\\n        const installScriptStable = 'https://my-netdata.io/kickstart-static64.sh';\\n        // cSpell:ignore dont\\n        yield spawn_1.exec(`bash <(curl -Ss \\\"${installScriptStable}\\\") --dont-wait`);\\n        // TODO: configure to work with nginx?\\n    });\\n}\\nexports.setupNetdata = setupNetdata;\\n\",\"\\\"use strict\\\";\\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\\n    return new (P || (P = Promise))(function (resolve, reject) {\\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\\n        function rejected(value) { try { step(generator[\\\"throw\\\"](value)); } catch (e) { reject(e); } }\\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\\n    });\\n};\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nconst Files_1 = require(\\\"../../utils/Files\\\");\\nconst readAvenConfig_1 = require(\\\"../../utils/readAvenConfig\\\");\\nfunction setupTimezone() {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        const { timezone } = yield readAvenConfig_1.readAvenConfig();\\n        if (!timezone)\\n            return;\\n        const path = '/etc/localtime';\\n        const next = `/etc/share/zoneinfo/${timezone}`;\\n        Files_1.ensureLinkIs(next, path);\\n    });\\n}\\nexports.setupTimezone = setupTimezone;\\n\",\"\\\"use strict\\\";\\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\\n    return new (P || (P = Promise))(function (resolve, reject) {\\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\\n        function rejected(value) { try { step(generator[\\\"throw\\\"](value)); } catch (e) { reject(e); } }\\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\\n    });\\n};\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nconst Files_1 = require(\\\"../../utils/Files\\\");\\nconst spawn_1 = require(\\\"../../utils/spawn\\\");\\nconst fs_1 = require(\\\"fs\\\");\\nconst aptDependencies_1 = require(\\\"./aptDependencies\\\");\\nconst readAvenConfig_1 = require(\\\"../../utils/readAvenConfig\\\");\\nconst { mkdir, chmod } = fs_1.promises;\\naptDependencies_1.addAptDependencies('nginx', 'certbot');\\n// cSpell:ignore letsencrypt webroot\\nconst certbotWebrootPath = '/var/lib/letsencrypt/webroot';\\n// Folder containing live certs from letsencrypt\\nconst letsencryptLive = '/etc/letsencrypt/live';\\nconst nginxConf = `user www-data;\\nworker_processes auto;\\npid /run/nginx.pid;\\n\\ninclude modules-enabled/*.conf;\\n\\nevents {\\n    worker_connections 768;\\n    # multi_accept on;\\n}\\n\\nhttp {\\n    include conf.d/*.conf;\\n}\\n`;\\nfunction setupNginxSnips() {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        const dir = '/etc/nginx/snips';\\n        yield mkdir(dir, { recursive: true });\\n        const snips = {};\\n        snips['force-main-https'] = `location / {\\n    return 301 https://$server_name$request_uri;\\n    #rewrite ^ https://$server_name$request_uri? permanent;\\n}\\n`;\\n        snips.letsencrypt = `location ^~ /.well-known/acme-challenge/ {\\n    default_type \\\"text/plain\\\";\\n    root ${certbotWebrootPath};\\n}\\n\\nlocation = /.well-known/acme-challenge/ {\\n    return 404;\\n}\\n`;\\n        // Simplified proxy headers\\n        snips['proxy-forwarded-headers'] = `proxy_set_header Host $host;\\nproxy_set_header Forwarded $proxy_add_forwarded;\\n`;\\n        // cSpell:ignore SAMEORIGIN\\n        // Popular forwarded headers\\n        snips['proxy-headers'] = `proxy_set_header Host $host;\\n#proxy_set_header Port $server_port;\\n#proxy_set_header X-Forwarded-Port $server_port;\\nproxy_set_header X-Real-IP $remote_addr;\\nproxy_set_header X-Forwarded-Proto $scheme;\\n#proxy_set_header X-Forwarded-Ssl $https;\\nproxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\\n#proxy_set_header X-Frame-Options SAMEORIGIN;\\n`;\\n        // Trust Cloudflare to set some headers for us\\n        snips['trust-cloudflare-ip'] = `set_real_ip_from 103.21.244.0/22;\\nset_real_ip_from 103.22.200.0/22;\\nset_real_ip_from 103.31.4.0/22;\\nset_real_ip_from 104.16.0.0/12;\\nset_real_ip_from 108.162.192.0/18;\\nset_real_ip_from 131.0.72.0/22;\\nset_real_ip_from 141.101.64.0/18;\\nset_real_ip_from 162.158.0.0/15;\\nset_real_ip_from 172.64.0.0/13;\\nset_real_ip_from 173.245.48.0/20;\\nset_real_ip_from 188.114.96.0/20;\\nset_real_ip_from 190.93.240.0/20;\\nset_real_ip_from 197.234.240.0/22;\\nset_real_ip_from 198.41.128.0/17;\\nset_real_ip_from 2400:cb00::/32;\\nset_real_ip_from 2606:4700::/32;\\nset_real_ip_from 2803:f800::/32;\\nset_real_ip_from 2405:b500::/32;\\nset_real_ip_from 2405:8100::/32;\\nset_real_ip_from 2c0f:f248::/32;\\nset_real_ip_from 2a06:98c0::/29;\\n\\n# use any of the following two\\nreal_ip_header CF-Connecting-IP;\\n#real_ip_header X-Forwarded-For;\\n`;\\n        // cSpell:ignore websockets fastcgi\\n        // Headers needed to enable Web Sockets\\n        snips['websockets-proxy-headers'] = `proxy_http_version 1.1;\\nproxy_set_header Upgrade $http_upgrade;\\nproxy_set_header Connection $connection_upgrade;\\n`;\\n        yield Promise.all([\\n            // let Ubuntu manage this one\\n            Files_1.ensureLinkIs('../snippets/fastcgi-php.conf', `${dir}/fastcgi-php.conf`),\\n            Files_1.ensureFilesAre(Object.entries(snips).map(([config, contents]) => ({\\n                filename: `${dir}/${config}.conf`,\\n                contents,\\n            }))),\\n        ]);\\n    });\\n}\\n// cSpell:ignore nopush nodelay keepalive sendfile proxied\\nfunction setupNginxConfigs() {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        const dir = '/etc/nginx/conf.d';\\n        const { domains } = yield readAvenConfig_1.readAvenConfig();\\n        yield mkdir(dir, { recursive: true });\\n        const conf = {};\\n        conf.basic = `sendfile on;\\ntcp_nopush on;\\ntcp_nodelay on;\\nkeepalive_timeout 65;\\ntypes_hash_max_size 2048;\\n# server_tokens off;\\n\\n# server_names_hash_bucket_size 64;\\n# server_name_in_redirect off;\\n\\ninclude /etc/nginx/mime.types;\\ndefault_type application/octet-stream;\\n`;\\n        conf.gzip = `gzip on;\\ngzip_disable \\\"msie6\\\";\\n\\n# gzip_vary on;\\n# gzip_proxied any;\\n# gzip_comp_level 6;\\n# gzip_buffers 16 8k;\\n# gzip_http_version 1.1;\\n# gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;\\n`;\\n        // Allow upgrading http connections. Required for Websockets.\\n        conf['http-upgrade'] = `map $http_upgrade $connection_upgrade {\\n    default upgrade;\\n    ''      close;\\n}\\n`;\\n        // Where should we log to\\n        conf.logging = `access_log /var/log/nginx/access.log;\\nerror_log /var/log/nginx/error.log;\\n`;\\n        const validForwardedHeaderPattern = '\\\"~^(,[ \\\\\\\\\\\\\\\\t]*)*([!#$%&\\\\'*+.^_`|~0-9A-Za-z-]+=([!#$%&\\\\'*+.^_`|~0-9A-Za-z-]+|\\\\\\\\\\\"([\\\\\\\\\\\\\\\\t \\\\\\\\\\\\\\\\x21\\\\\\\\\\\\\\\\x23-\\\\\\\\\\\\\\\\x5B\\\\\\\\\\\\\\\\x5D-\\\\\\\\\\\\\\\\x7E\\\\\\\\\\\\\\\\x80-\\\\\\\\\\\\\\\\xFF]|\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\[\\\\\\\\\\\\\\\\t \\\\\\\\\\\\\\\\x21-\\\\\\\\\\\\\\\\x7E\\\\\\\\\\\\\\\\x80-\\\\\\\\\\\\\\\\xFF])*\\\\\\\\\\\"))?(;([!#$%&\\\\'*+.^_`|~0-9A-Za-z-]+=([!#$%&\\\\'*+.^_`|~0-9A-Za-z-]+|\\\\\\\\\\\"([\\\\\\\\\\\\\\\\t \\\\\\\\\\\\\\\\x21\\\\\\\\\\\\\\\\x23-\\\\\\\\\\\\\\\\x5B\\\\\\\\\\\\\\\\x5D-\\\\\\\\\\\\\\\\x7E\\\\\\\\\\\\\\\\x80-\\\\\\\\\\\\\\\\xFF]|\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\[\\\\\\\\\\\\\\\\t \\\\\\\\\\\\\\\\x21-\\\\\\\\\\\\\\\\x7E\\\\\\\\\\\\\\\\x80-\\\\\\\\\\\\\\\\xFF])*\\\\\\\\\\\"))?)*([ \\\\\\\\\\\\\\\\t]*,([ \\\\\\\\\\\\\\\\t]*([!#$%&\\\\'*+.^_`|~0-9A-Za-z-]+=([!#$%&\\\\'*+.^_`|~0-9A-Za-z-]+|\\\\\\\\\\\"([\\\\\\\\\\\\\\\\t \\\\\\\\\\\\\\\\x21\\\\\\\\\\\\\\\\x23-\\\\\\\\\\\\\\\\x5B\\\\\\\\\\\\\\\\x5D-\\\\\\\\\\\\\\\\x7E\\\\\\\\\\\\\\\\x80-\\\\\\\\\\\\\\\\xFF]|\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\[\\\\\\\\\\\\\\\\t \\\\\\\\\\\\\\\\x21-\\\\\\\\\\\\\\\\x7E\\\\\\\\\\\\\\\\x80-\\\\\\\\\\\\\\\\xFF])*\\\\\\\\\\\"))?(;([!#$%&\\\\'*+.^_`|~0-9A-Za-z-]+=([!#$%&\\\\'*+.^_`|~0-9A-Za-z-]+|\\\\\\\\\\\"([\\\\\\\\\\\\\\\\t \\\\\\\\\\\\\\\\x21\\\\\\\\\\\\\\\\x23-\\\\\\\\\\\\\\\\x5B\\\\\\\\\\\\\\\\x5D-\\\\\\\\\\\\\\\\x7E\\\\\\\\\\\\\\\\x80-\\\\\\\\\\\\\\\\xFF]|\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\[\\\\\\\\\\\\\\\\t \\\\\\\\\\\\\\\\x21-\\\\\\\\\\\\\\\\x7E\\\\\\\\\\\\\\\\x80-\\\\\\\\\\\\\\\\xFF])*\\\\\\\\\\\"))?)*)?)*$\\\"\\\\n';\\n        //\\n        conf['proxy-add-forwarded'] = `map $remote_addr $proxy_forwarded_elem {\\n    # IPv4 addresses can be sent as-is\\n    ~^[0-9.]+$          \\\"for=$remote_addr\\\";\\n\\n    # IPv6 addresses need to be bracketed and quoted\\n    ~^[0-9A-Fa-f:.]+$   \\\"for=\\\\\\\\\\\"[$remote_addr]\\\\\\\\\\\"\\\";\\n\\n    # Unix domain socket names cannot be represented in RFC 7239 syntax\\n    default             \\\"for=unknown\\\";\\n}\\n\\nmap $http_forwarded $proxy_add_forwarded {\\n    # If the incoming Forwarded header is syntactically valid, append to it\\n    ${validForwardedHeaderPattern} \\\"$http_forwarded, $proxy_forwarded_elem\\\";\\n\\n    # Otherwise, replace it\\n    default \\\"$proxy_forwarded_elem\\\";\\n}\\n`;\\n        // List of nginx server blocks (in files)\\n        conf.servers = `include servers/*.conf;\\n`;\\n        // Default SSL configurations.\\n        conf.ssl = `##\\n# SSL Settings\\n##\\n\\n# Default keys. Overridden in server configs.\\nssl_certificate     ${letsencryptLive}/${domains[0]}/fullchain.pem;\\nssl_certificate_key ${letsencryptLive}/${domains[0]}/privkey.pem;\\n\\n\\nssl_protocols TLSv1 TLSv1.1 TLSv1.2; # Dropping SSLv3, ref: POODLE\\nssl_prefer_server_ciphers on;\\n`;\\n        yield Files_1.ensureFilesAre(Object.entries(conf).map(([config, contents]) => ({\\n            filename: `${dir}/${config}.conf`,\\n            contents,\\n        })));\\n    });\\n}\\nfunction setupNginxBasicServers() {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        const dir = '/etc/nginx/servers';\\n        yield mkdir(dir, { recursive: true });\\n        const serverConfigDefault = `server {\\n      listen 80;\\n      listen [::]:80;\\n      listen 443 ssl;\\n      listen [::]:443 ssl;\\n  \\n      include snips/letsencrypt.conf;\\n  \\n      location / {\\n          default_type text/plain;\\n          return 200 'Nothing to see here...';\\n      }\\n  }\\n  `;\\n        yield Files_1.ensureFileIs(`${dir}/00_default.conf`, serverConfigDefault);\\n    });\\n}\\nfunction setupNginxServersFull() {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        const { rootPath, domains, serviceName } = yield readAvenConfig_1.readAvenConfig();\\n        if (rootPath)\\n            yield mkdir(rootPath, { recursive: true });\\n        const upstreamUniqueName = domains[0].replace('.', '_');\\n        // Name of the socket file used for communications with\\n        const socketFilename = 'sock';\\n        // Directory the daemon runs in\\n        const workingDir = `/run/${serviceName}`;\\n        // Nginx backend location\\n        const upstreamHost = `unix:${workingDir}/${socketFilename}`;\\n        const serverConfig = `server {\\n    server_name ${domains.join(' ')};\\n    listen 80 default_server;\\n    listen [::]:80 default_server;\\n\\n    include snips/letsencrypt.conf;\\n    include snips/force-main-https.conf;\\n}\\n\\nserver {\\n    server_name ${domains.join(' ')};\\n    listen 443 ssl default_server;\\n    listen [::]:443 ssl default_server;\\n\\n    ssl_certificate     ${letsencryptLive}/${domains[0]}/fullchain.pem;\\n    ssl_certificate_key ${letsencryptLive}/${domains[0]}/privkey.pem;\\n\\n    include snips/trust-cloudflare-ip.conf;\\n\\n    location / ${!rootPath\\n            ? ''\\n            : `{\\n      root ${rootPath};\\n      # If files exist in root, serve them. Otherwise fallback to proxy.\\n      try_files $uri $uri/index.html @proxyHandler;\\n    }\\n    \\n    location @proxyHandler `}{\\n        include snips/websockets-proxy-headers.conf;\\n        include snips/proxy-headers.conf;\\n        proxy_pass http://${upstreamUniqueName};\\n    }\\n}\\n\\nupstream ${upstreamUniqueName} {\\n    server ${upstreamHost} fail_timeout=0;\\n}\\n`;\\n        yield Files_1.ensureFileIs(`/etc/nginx/servers/${domains[0]}.conf`, serverConfig);\\n    });\\n}\\nconst nginxConfigFile = '/etc/nginx/nginx.conf';\\nfunction setupNginxBasic() {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        yield Promise.all([\\n            Files_1.ensureFileIs(nginxConfigFile, nginxConf),\\n            setupNginxSnips(),\\n            setupNginxConfigs(),\\n            setupNginxBasicServers(),\\n        ]);\\n    });\\n}\\n// cSpell:ignore logrotate logrotation\\nconst certbotCliConfig = `authenticator = webroot\\nwebroot-path = ${certbotWebrootPath}\\n\\n# Because we are using logrotate for greater flexibility, disable the\\n# internal certbot logrotation.\\nmax-log-backups = 0\\n`;\\nconst certbotPostRenewNginx = `#!/bin/bash\\nsystemctl reload nginx\\n`;\\n// cSpell:ignore YOURDOMAIN privkey fullchain noninteractive\\nfunction setupCertbot() {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        const { domains } = yield readAvenConfig_1.readAvenConfig();\\n        yield Promise.all([\\n            Files_1.ensureFileIs('/etc/letsencrypt/cli.ini', certbotCliConfig),\\n            mkdir(certbotWebrootPath, { recursive: true }),\\n        ]);\\n        /**\\n         * Use this for other services that depend on generated keys but require them combined. Like ZNC.\\n         */\\n        const outputFile = '/var/lib/znc/znc.pem';\\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\\n        const certbotPostRenewExampleFullChain = `#!/bin/bash\\nYOURDOMAIN=\\\"${domains[0]}\\\"\\n\\n[[ $RENEWED_LINEAGE != \\\"${letsencryptLive}/$YOURDOMAIN\\\" ]] && exit 0\\n\\n# Combine certs into single file for some applications that don't support separation\\ncat ${letsencryptLive}/$YOURDOMAIN/{privkey,fullchain}.pem > ${outputFile}\\n`;\\n        // TODO: Support multiple independent domains that serve different websites.\\n        // Run once for each nginx server. Generates one key pair. Must include all domains that share server.\\n        yield spawn_1.spawn('certbot', \\n        // cSpell:ignore certonly\\n        'certonly', '--expand', '--noninteractive', '--agree-tos', \\n        // Registered e-mail\\n        '-m', \\n        // TODO: use better email\\n        `admin@${domains[0]}`, \\n        // Add a \\\"--domain\\\" before each domain\\n        ...domains.reduce((res, current) => res.concat('--domain', current), []));\\n        // Setup hook after getting keys for the first time\\n        const hook = '/etc/letsencrypt/renewal-hooks/deploy/reload-nginx';\\n        yield Files_1.ensureFileIs(hook, certbotPostRenewNginx);\\n        yield chmod(hook, 0o755);\\n    });\\n}\\nfunction checkNginxConfig() {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        yield spawn_1.spawn('nginx', '-tc', nginxConfigFile);\\n    });\\n}\\nfunction setupNginx() {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        // Ensure Let's Encrypt configuration is setup\\n        yield setupNginxBasic();\\n        yield checkNginxConfig();\\n        yield spawn_1.exec(`systemctl reload nginx.service`);\\n        // Before trying to get possibly new keys\\n        yield setupCertbot();\\n        // Only then do we make sure the rest of the server files are setup\\n        yield setupNginxServersFull();\\n        yield checkNginxConfig();\\n        yield spawn_1.exec(`systemctl reload nginx.service`);\\n    });\\n}\\nexports.setupNginx = setupNginx;\\n\",\"\\\"use strict\\\";\\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\\n    return new (P || (P = Promise))(function (resolve, reject) {\\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\\n        function rejected(value) { try { step(generator[\\\"throw\\\"](value)); } catch (e) { reject(e); } }\\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\\n    });\\n};\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nconst Files_1 = require(\\\"../../../utils/Files\\\");\\nconst spawn_1 = require(\\\"../../../utils/spawn\\\");\\nconst readAvenConfig_1 = require(\\\"../../../utils/readAvenConfig\\\");\\nfunction setupJournalbeat() {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        const { journalbeat } = yield readAvenConfig_1.readAvenConfig();\\n        if (!journalbeat)\\n            return;\\n        yield spawn_1.exec('wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | apt-key add -');\\n        // Replace list every time\\n        yield Files_1.ensureFileIs('/etc/apt/sources.list.d/elastic-7.x.list', 'deb https://artifacts.elastic.co/packages/7.x/apt stable main\\\\n');\\n        yield spawn_1.exec('apt-get update');\\n        yield spawn_1.exec('apt-get install -y journalbeat');\\n        // TODO: Add to list of apt\\n        yield spawn_1.exec('systemctl enable journalbeat');\\n        let journalbeatConfig = `journalbeat.inputs:\\n  - paths: []\\n    #backoff: 1s\\n    #max_backoff: 20s\\n    seek: cursor\\n    #cursor_seek_fallback: head\\n    #include_matches: []\\n    #fields:\\n\\n  #journalbeat:\\n    #registry_file: registry\\n\\n  setup.template.settings:\\n    index.number_of_shards: 1\\n    #index.codec: best_compression\\n    #_source.enabled: false\\n\\n  #name:\\n  #tags: [\\\"service-X\\\", \\\"web-tier\\\"]\\n  #fields:\\n\\n  #setup.dashboards.enabled: false\\n  #setup.dashboards.url:\\n\\n  processors:\\n    - add_host_metadata: ~\\n    - add_cloud_metadata: ~  \\n    - decode_json_fields:\\n        fields: [\\\"message\\\"]\\n        process_array: true\\n        max_depth: 8\\n        target: \\\"\\\"\\n\\n  #logging.level: debug\\n  #logging.selectors: [\\\"*\\\"]\\n\\n  #monitoring.enabled: false\\n  #monitoring.cluster_uuid:\\n  #monitoring.elasticsearch:\\n\\n  #migration.6_to_7.enabled: true\\n\\n`;\\n        if (journalbeat.kibanaHost) {\\n            journalbeatConfig += `setup.kibana:\\n  host: \\\"${journalbeat.kibanaHost}\\\"\\n\\n`;\\n        }\\n        if (journalbeat.elastic) {\\n            journalbeatConfig += `output.elasticsearch:\\n  hosts: ${JSON.stringify(journalbeat.elastic.hosts)}\\n  #protocol: \\\"https\\\"\\n  username: ${JSON.stringify(journalbeat.elastic.username)}\\n  password: ${JSON.stringify(journalbeat.elastic.password)}\\n\\n`;\\n        }\\n        if (journalbeat.logstashHosts) {\\n            journalbeatConfig += `output.logstash:\\n  hosts: ${JSON.stringify(journalbeat.logstashHosts)}\\n  #ssl.certificate_authorities: [\\\"/etc/pki/root/ca.pem\\\"]\\n  #ssl.certificate: \\\"/etc/pki/client/cert.pem\\\"\\n  #ssl.key: \\\"/etc/pki/client/cert.key\\\"\\n\\n`;\\n        }\\n        const change = yield Files_1.ensureFileIs('/etc/journalbeat/journalbeat.yml', journalbeatConfig);\\n        yield spawn_1.exec(`systemctl ${change ? 'restart' : 'start'} journalbeat`);\\n    });\\n}\\nexports.setupJournalbeat = setupJournalbeat;\\n\",\"\\\"use strict\\\";\\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\\n    return new (P || (P = Promise))(function (resolve, reject) {\\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\\n        function rejected(value) { try { step(generator[\\\"throw\\\"](value)); } catch (e) { reject(e); } }\\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\\n    });\\n};\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nconst Nginx_1 = require(\\\"./setup/Nginx\\\");\\nconst MainServiceFiles_1 = require(\\\"./setup/MainServiceFiles\\\");\\nconst MonitoringTools_1 = require(\\\"./setup/MonitoringTools\\\");\\nconst DeveloperTools_1 = require(\\\"./setup/DeveloperTools\\\");\\nconst basicServer_1 = require(\\\"./setup/basicServer\\\");\\nconst printOSInfo_1 = require(\\\"../utils/printOSInfo\\\");\\nfunction prepare() {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        // Initial smoke test\\n        yield printOSInfo_1.printOSInfo();\\n        yield basicServer_1.basicServerSetup();\\n        yield Promise.all([\\n            MonitoringTools_1.setupMonitoringTools(),\\n            DeveloperTools_1.setupDevTools(),\\n            Nginx_1.setupNginx(),\\n            MainServiceFiles_1.setupMainServiceFiles(),\\n        ]);\\n        console.log('Server configured!');\\n    });\\n}\\nexports.prepare = prepare;\\nif (!module.parent) {\\n    prepare().catch(e => {\\n        console.log('Error running!');\\n        console.log(e);\\n        process.exitCode = 1;\\n    });\\n}\\n\",\"module.exports = require(\\\"child_process\\\");\",\"module.exports = require(\\\"https\\\");\",\"\\\"use strict\\\";\\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\\n    return new (P || (P = Promise))(function (resolve, reject) {\\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\\n        function rejected(value) { try { step(generator[\\\"throw\\\"](value)); } catch (e) { reject(e); } }\\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\\n    });\\n};\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nconst Journalbeat_1 = require(\\\"./MonitorTools/Journalbeat\\\");\\nconst Netdata_1 = require(\\\"./MonitorTools/Netdata\\\");\\nconst Cockpit_1 = require(\\\"./MonitorTools/Cockpit\\\");\\nconst FailureNotificationServices_1 = require(\\\"./MonitorTools/FailureNotificationServices\\\");\\nconst PersistentJournal_1 = require(\\\"./MonitorTools/PersistentJournal\\\");\\nfunction setupMonitoringTools() {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        yield Promise.all([\\n            Journalbeat_1.setupJournalbeat(),\\n            Netdata_1.setupNetdata(),\\n            Cockpit_1.setupCockpit(),\\n            FailureNotificationServices_1.setupFailureNotificationService(),\\n            PersistentJournal_1.setupPersistentJournal(),\\n        ]);\\n    });\\n}\\nexports.setupMonitoringTools = setupMonitoringTools;\\n\",\"\\\"use strict\\\";\\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\\n    return new (P || (P = Promise))(function (resolve, reject) {\\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\\n        function rejected(value) { try { step(generator[\\\"throw\\\"](value)); } catch (e) { reject(e); } }\\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\\n    });\\n};\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nfunction setupFailureNotificationService() {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        // TODO: Fill out\\n        // Ruby Service\\n        // https://github.com/joonty/systemd_mon\\n        // Manually with Systemd\\n        // https://serverfault.com/questions/694818/get-notification-when-systemd-monitored-service-enters-failed-state\\n    });\\n}\\nexports.setupFailureNotificationService = setupFailureNotificationService;\\n\",\"\\\"use strict\\\";\\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\\n    return new (P || (P = Promise))(function (resolve, reject) {\\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\\n        function rejected(value) { try { step(generator[\\\"throw\\\"](value)); } catch (e) { reject(e); } }\\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\\n    });\\n};\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nconst Files_1 = require(\\\"../../utils/Files\\\");\\nconst spawn_1 = require(\\\"../../utils/spawn\\\");\\nconst deps = [];\\n// List of apt dependencies needed by various parts\\nfunction addAptDependencies(...dependencies) {\\n    deps.push(...dependencies);\\n}\\nexports.addAptDependencies = addAptDependencies;\\nfunction setupAptDependencies() {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        // TODO: Don't assume yarn\\n        yield spawn_1.exec('curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add -');\\n        yield Files_1.ensureFileIs('/etc/apt/sources.list.d/yarn.list', 'deb https://dl.yarnpkg.com/debian/ stable main');\\n        yield spawn_1.spawn('apt-get', 'update');\\n        yield spawn_1.spawn('apt-get', 'upgrade', '-y');\\n        // cSpell:ignore noninteractive autoremove\\n        yield spawn_1.spawn('apt-get', \\n        // Avoid all interactive prompts https://serverfault.com/questions/227190\\n        { stdio: 'inherit', env: { DEBIAN_FRONTEND: 'noninteractive' } }, 'install', '-yq', ...deps);\\n        yield spawn_1.spawn('apt-get', 'autoremove', '-y');\\n    });\\n}\\nexports.setupAptDependencies = setupAptDependencies;\\n\",\"\\\"use strict\\\";\\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\\n    return new (P || (P = Promise))(function (resolve, reject) {\\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\\n        function rejected(value) { try { step(generator[\\\"throw\\\"](value)); } catch (e) { reject(e); } }\\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\\n    });\\n};\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nconst fs_1 = require(\\\"fs\\\");\\nconst { mkdir } = fs_1.promises;\\nfunction setupPersistentJournal() {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        yield mkdir('/var/log/journal', { recursive: true });\\n    });\\n}\\nexports.setupPersistentJournal = setupPersistentJournal;\\n\",\"\\\"use strict\\\";\\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\\n    return new (P || (P = Promise))(function (resolve, reject) {\\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\\n        function rejected(value) { try { step(generator[\\\"throw\\\"](value)); } catch (e) { reject(e); } }\\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\\n    });\\n};\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nconst fs_1 = require(\\\"fs\\\");\\nconst { readFile } = fs_1.promises;\\nlet secrets;\\nfunction readAvenSecrets() {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        if (secrets === undefined) {\\n            const contents = yield readFile('secrets.json');\\n            secrets = JSON.parse(contents.toString());\\n            // TODO: Sanitize ret object more...\\n        }\\n        return secrets;\\n    });\\n}\\nexports.readAvenSecrets = readAvenSecrets;\\n\",\"\\\"use strict\\\";\\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\\n    return new (P || (P = Promise))(function (resolve, reject) {\\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\\n        function rejected(value) { try { step(generator[\\\"throw\\\"](value)); } catch (e) { reject(e); } }\\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\\n    });\\n};\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nconst fs_1 = require(\\\"fs\\\");\\nconst { readFile } = fs_1.promises;\\nfunction printOSInfo() {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        const release = (yield readFile('/etc/lsb-release')).toString();\\n        // cSpell:ignore DISTRIB\\n        /**\\n         * Sample /etc/lsb-release:\\n         * DISTRIB_ID=Ubuntu\\n         * DISTRIB_RELEASE=18.04\\n         * DISTRIB_CODENAME=bionic\\n         * DISTRIB_DESCRIPTION=\\\"Ubuntu 18.04.3 LTS\\\".\\n         */\\n        // Dirty get OS version\\n        const osVersion = release\\n            .split('\\\\n')[3]\\n            .split('=')[1]\\n            .split('\\\"')[1];\\n        console.log('OS Version', osVersion);\\n    });\\n}\\nexports.printOSInfo = printOSInfo;\\n\",\"\\\"use strict\\\";\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nconst child_process_1 = require(\\\"child_process\\\");\\nconst util_1 = require(\\\"util\\\");\\nconst defaultShell = '/bin/bash';\\nfunction spawn(command, first, ...args) {\\n    // console.log('Spawning:', command, ...args);\\n    const defOpts = { stdio: 'inherit' };\\n    const proc = typeof first === 'string'\\n        ? child_process_1.spawn(command, [first, ...args], defOpts)\\n        : child_process_1.spawn(command, args, first === true\\n            ? Object.assign(Object.assign({}, defOpts), { shell: defaultShell }) : Object.assign(Object.assign({}, defOpts), first));\\n    const ret = new Promise((resolve, reject) => {\\n        proc.on('exit', exitCode => {\\n            if (exitCode) {\\n                reject(new Error(`Exit code: ${exitCode}`));\\n            }\\n            else {\\n                resolve();\\n            }\\n        });\\n    });\\n    ret.child = proc;\\n    return ret;\\n}\\nexports.spawn = spawn;\\nconst execP = util_1.promisify(child_process_1.exec);\\n/**\\n * Run a command and capture output.\\n *\\n * Prints nothing.\\n *\\n * - Shell\\n * - Captured & Buffered output\\n * - Promised result.\\n *\\n * @param {string} command - The command to run.\\n * @param {true|string} shell - Should we use a shell. Default true.\\n * @returns {ChildProcess} The child.\\n */\\nfunction exec(command, shell = true) {\\n    if (shell === null) {\\n        return execP(command);\\n    }\\n    if (shell === true)\\n        shell = defaultShell;\\n    return execP(command, { shell });\\n}\\nexports.exec = exec;\\n\",\"\\\"use strict\\\";\\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\\n    return new (P || (P = Promise))(function (resolve, reject) {\\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\\n        function rejected(value) { try { step(generator[\\\"throw\\\"](value)); } catch (e) { reject(e); } }\\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\\n    });\\n};\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nconst Files_1 = require(\\\"../../utils/Files\\\");\\nconst spawn_1 = require(\\\"../../utils/spawn\\\");\\nfunction setupSecurity() {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        // Disable password authentication on sshd\\n        const changed = yield Files_1.ensureFileContains('/etc/ssh/sshd_config', '\\\\nPasswordAuthentication no\\\\n');\\n        if (changed) {\\n            yield spawn_1.exec('systemctl reload sshd');\\n        }\\n    });\\n}\\nexports.setupSecurity = setupSecurity;\\n\",\"\\\"use strict\\\";\\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\\n    return new (P || (P = Promise))(function (resolve, reject) {\\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\\n        function rejected(value) { try { step(generator[\\\"throw\\\"](value)); } catch (e) { reject(e); } }\\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\\n    });\\n};\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nconst Timezone_1 = require(\\\"./Timezone\\\");\\nconst aptDependencies_1 = require(\\\"./aptDependencies\\\");\\nconst Security_1 = require(\\\"./Security\\\");\\nfunction basicServerSetup() {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        yield Security_1.setupSecurity();\\n        yield Timezone_1.setupTimezone();\\n        // TODO: hostname, /etc/hosts\\n        yield aptDependencies_1.setupAptDependencies();\\n    });\\n}\\nexports.basicServerSetup = basicServerSetup;\\n\",\"\\\"use strict\\\";\\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\\n    return new (P || (P = Promise))(function (resolve, reject) {\\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\\n        function rejected(value) { try { step(generator[\\\"throw\\\"](value)); } catch (e) { reject(e); } }\\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\\n    });\\n};\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nconst Files_1 = require(\\\"../../utils/Files\\\");\\nconst Root_1 = require(\\\"./Root\\\");\\nconst aptDependencies_1 = require(\\\"./aptDependencies\\\");\\naptDependencies_1.addAptDependencies('screen', 'git', 'yarn');\\nexports.screenConfig = \\\"\\\\ncaption always '%{= dg} %H %{G}| %{B}%l %{G}|%=%?%{d}%-w%?%{r}(%{d}%n %t%? {%u} %?%{r})%{d}%?%+w%?%=%{G}| %{B}%M %d %c:%s '\\\\n\\\";\\n/**\\n * Tools to help developers if they need to connect to server manually.\\n */\\nfunction setupDevTools() {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        yield Promise.all([\\n            // Handy screen config (multiple tabs)\\n            Files_1.ensureFileContains('/etc/screenrc', exports.screenConfig),\\n            Root_1.setupRoot(),\\n        ]);\\n    });\\n}\\nexports.setupDevTools = setupDevTools;\\n\",\"\\\"use strict\\\";\\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\\n    return new (P || (P = Promise))(function (resolve, reject) {\\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\\n        function rejected(value) { try { step(generator[\\\"throw\\\"](value)); } catch (e) { reject(e); } }\\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\\n    });\\n};\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nconst fs_1 = require(\\\"fs\\\");\\nconst spawn_1 = require(\\\"../../utils/spawn\\\");\\nconst Files_1 = require(\\\"../../utils/Files\\\");\\nconst readAvenConfig_1 = require(\\\"../../utils/readAvenConfig\\\");\\nconst { mkdir } = fs_1.promises;\\nfunction setupMainServiceFiles() {\\n    var _a, _b;\\n    return __awaiter(this, void 0, void 0, function* () {\\n        const config = yield readAvenConfig_1.readAvenConfig();\\n        const serviceName = (_a = config.serviceName, (_a !== null && _a !== void 0 ? _a : config.domains[0]));\\n        const serviceDescription = (_b = config.serviceDescription, (_b !== null && _b !== void 0 ? _b : 'Runtime server'));\\n        const serviceFile = `/etc/systemd/system/${serviceName}.service`;\\n        const dir = mkdir(`${serviceFile}.d`, { recursive: true });\\n        const serviceFileContents = `[Unit]\\n  Description=${serviceDescription}\\n  After=network.target\\n  \\n  [Service]\\n  Type=simple\\n  Environment=LISTEN_PATH=\\\"/run/${serviceName}/sock\\\"\\n  RuntimeDirectory=${serviceName}\\n  WorkingDirectory=/opt/${serviceName}\\n  ExecStart=/usr/bin/npm start\\n  User=www-data\\n  \\n  [Install]\\n  WantedBy=default.target\\n  `;\\n        yield Files_1.ensureFileIs(serviceFile, serviceFileContents);\\n        // Tell systemd to read our changes\\n        yield spawn_1.exec(`systemctl daemon-reload`);\\n        // Run service on server boot\\n        yield spawn_1.exec(`systemctl enable ${serviceName}.service`);\\n        yield dir;\\n    });\\n}\\nexports.setupMainServiceFiles = setupMainServiceFiles;\\n\",\"\\\"use strict\\\";\\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\\n    return new (P || (P = Promise))(function (resolve, reject) {\\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\\n        function rejected(value) { try { step(generator[\\\"throw\\\"](value)); } catch (e) { reject(e); } }\\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\\n    });\\n};\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nconst https_1 = require(\\\"https\\\");\\nfunction request(httpsUrl) {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        return new Promise((resolve, reject) => __awaiter(this, void 0, void 0, function* () {\\n            let response = '';\\n            const req = https_1.get(httpsUrl, res => {\\n                res.on('data', chunk => {\\n                    response += chunk;\\n                });\\n                res.on('end', () => {\\n                    resolve(response);\\n                    req.end();\\n                });\\n            });\\n            req.on('error', reject);\\n        }));\\n    });\\n}\\nexports.request = request;\\n\",\"module.exports = require(\\\"path\\\");\",\"module.exports = require(\\\"util\\\");\",\"\\\"use strict\\\";\\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\\n    return new (P || (P = Promise))(function (resolve, reject) {\\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\\n        function rejected(value) { try { step(generator[\\\"throw\\\"](value)); } catch (e) { reject(e); } }\\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\\n    });\\n};\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nconst fs_1 = require(\\\"fs\\\");\\nconst { readFile } = fs_1.promises;\\nlet config;\\nfunction readAvenConfig() {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        if (config === undefined) {\\n            const contents = yield readFile('aven.json');\\n            config = JSON.parse(contents.toString());\\n            if (!config.domains) {\\n                throw new Error('`domains` not defined in `aven.json`.');\\n            }\\n            if (!Array.isArray(config.domains)) {\\n                throw new Error('`domains` in `aven.json` is not an Array.');\\n            }\\n            if (config.domains.length < 1) {\\n                throw new Error('Need at least one domain defined');\\n            }\\n            // TODO: Sanitize object more...\\n        }\\n        return config;\\n    });\\n}\\nexports.readAvenConfig = readAvenConfig;\\n\",\"\\\"use strict\\\";\\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\\n    return new (P || (P = Promise))(function (resolve, reject) {\\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\\n        function rejected(value) { try { step(generator[\\\"throw\\\"](value)); } catch (e) { reject(e); } }\\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\\n    });\\n};\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nconst Files_1 = require(\\\"../../utils/Files\\\");\\nconst request_1 = require(\\\"../../utils/request\\\");\\nconst User_1 = require(\\\"../../utils/User\\\");\\nconst path_1 = require(\\\"path\\\");\\nconst fs_1 = require(\\\"fs\\\");\\nconst readSecrets_1 = require(\\\"../../utils/readSecrets\\\");\\nconst { mkdir } = fs_1.promises;\\nfunction fixAuthorizedKeys(user, keySources) {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        const userDir = yield User_1.userHome(user);\\n        const sshConfDir = path_1.join(userDir, '.ssh');\\n        const { deployPublicKey } = yield readSecrets_1.readAvenSecrets();\\n        yield Promise.all(keySources.map((url) => __awaiter(this, void 0, void 0, function* () { return yield request_1.request(url); })))\\n            .then(keys => [...keys, deployPublicKey, '']) // Empty string to ensure file ends in a newline\\n            .then(keys => keys.join('\\\\n'))\\n            .then(allKeys => Files_1.ensureFileIs(path_1.join(sshConfDir, 'authorized_keys'), allKeys));\\n    });\\n}\\nexports.fixAuthorizedKeys = fixAuthorizedKeys;\\n/**\\n * Configure root user settings.\\n *\\n * @param {string[]} sources - List of URLs to load developer keys from.\\n */\\nfunction setupRoot(sources) {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        const userDir = yield User_1.userHome('root');\\n        const sshConfDir = path_1.join(userDir, '.ssh');\\n        yield mkdir(sshConfDir, { recursive: true });\\n        if (!sources)\\n            sources = [];\\n        yield Promise.all([\\n            // Make it easy for root user to clone from github\\n            User_1.fixKnownHosts(userDir),\\n            fixAuthorizedKeys('root', (sources !== null && sources !== void 0 ? sources : [])),\\n        ]);\\n    });\\n}\\nexports.setupRoot = setupRoot;\\n\",\"module.exports = require(\\\"fs\\\");\",\"\\\"use strict\\\";\\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\\n    return new (P || (P = Promise))(function (resolve, reject) {\\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\\n        function rejected(value) { try { step(generator[\\\"throw\\\"](value)); } catch (e) { reject(e); } }\\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\\n    });\\n};\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nconst fs_1 = require(\\\"fs\\\");\\nconst { readFile, writeFile, symlink, readlink, unlink } = fs_1.promises;\\nfunction ensureFileContains(filename, contents) {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        const current = (yield readFile(filename).catch(() => '')).toString();\\n        if (current.includes(contents))\\n            return false;\\n        yield writeFile(filename, current + contents);\\n        return true;\\n    });\\n}\\nexports.ensureFileContains = ensureFileContains;\\nfunction ensureFileIs(filename, contents) {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        // We could just skip the read part of this but this preserves modification times\\n        const current = (yield readFile(filename).catch(() => '')).toString();\\n        if (current === contents)\\n            return false;\\n        yield writeFile(filename, contents);\\n        return true;\\n    });\\n}\\nexports.ensureFileIs = ensureFileIs;\\nfunction ensureFilesAre(list) {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        yield Promise.all(list.map(({ filename, contents }) => ensureFileIs(filename, contents)));\\n    });\\n}\\nexports.ensureFilesAre = ensureFilesAre;\\nfunction ensureLinkIs(target, path) {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        const current = yield readlink(path).catch(e => {\\n            if (e.code === 'ENOENT')\\n                return undefined;\\n            throw e;\\n        });\\n        if (target === current)\\n            return;\\n        if (current !== undefined)\\n            yield unlink(path);\\n        yield symlink(target, path);\\n    });\\n}\\nexports.ensureLinkIs = ensureLinkIs;\\n\",\"\\\"use strict\\\";\\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\\n    return new (P || (P = Promise))(function (resolve, reject) {\\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\\n        function rejected(value) { try { step(generator[\\\"throw\\\"](value)); } catch (e) { reject(e); } }\\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\\n    });\\n};\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nconst path_1 = require(\\\"path\\\");\\nconst fs_1 = require(\\\"fs\\\");\\nconst Files_1 = require(\\\"./Files\\\");\\nconst spawn_1 = require(\\\"./spawn\\\");\\nconst { mkdir } = fs_1.promises;\\nconst userGroups = ['sudo', 'adm', 'systemd-journal'];\\nconst UsernameInUseUserAddExitValue = 9;\\nfunction userHome(name) {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        // TODO: Read from os\\n        return name === 'root' ? '/root' : `/home/${name}`;\\n    });\\n}\\nexports.userHome = userHome;\\n/**\\n * Create a new user and setup home dir.\\n *\\n * @param {string} name - Username to make.\\n */\\nfunction createAndConfigureUser(name) {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        const command = [];\\n        // cSpell:ignore useradd\\n        command.push('useradd');\\n        // Don't use a group with same name as user (use \\\"users\\\" instead)\\n        command.push('--no-user-group');\\n        command.push('--gid', 'users');\\n        command.push('--shell', '/bin/bash');\\n        // Create home directory for user\\n        command.push('--create-home');\\n        // Default list of groups\\n        command.push('--groups', userGroups.join(','));\\n        // Username we're making\\n        command.push(name);\\n        yield spawn_1.exec(command.join(' ')).catch(e => {\\n            if (e.code !== UsernameInUseUserAddExitValue)\\n                throw e;\\n            console.log(`User ${name} exists`);\\n            // cSpell:ignore usermod\\n            // TODO: `usermod` to make sure user options are consistent (in case they change)\\n        });\\n        const home = yield userHome(name);\\n        yield mkdir(`${home}/.ssh`, { recursive: true });\\n        yield fixKnownHosts(home);\\n    });\\n}\\nexports.createAndConfigureUser = createAndConfigureUser;\\nfunction ensureKey(user, key) {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        yield Files_1.ensureFileContains(`${yield userHome(user)}/.ssh/authorized_keys`, key);\\n    });\\n}\\nexports.ensureKey = ensureKey;\\nconst GitHubKnownHosts = 'github.com ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAq2A7hRGmdnm9tUDbO9IDSwBK6TbQa+PXYPCPy6rbTrTtw7PHkccKrpp0yVhp5HdEIcKr6pLlVDBfOLX9QUsyCOV0wzfjIJNlGEYsdlLJizHhbn2mUjvSAHQqZETYP81eFzLQNnPHt4EVVUh7VfDESU84KezmD5QlWpXLmvU31/yMf+Se8xhHTvKSCZIFImWwoG6mbUoWf9nzpIoaSjB+weqqUUmpaaasXVal72J+UX2B+2RPW3RcT0eOzQgqlJL3RKrTJvdsjE3JEAvGq3lGHSZXy28G3skua2SmVi/w4yCE6gbODqnTWlg7+wC604ydGXA8VJiS5ap43JXiUFFAaQ==';\\nfunction fixKnownHosts(userDir) {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        return Files_1.ensureFileContains(path_1.join(userDir, '.ssh', 'known_hosts'), GitHubKnownHosts);\\n    });\\n}\\nexports.fixKnownHosts = fixKnownHosts;\\n\",\"\\\"use strict\\\";\\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\\n    return new (P || (P = Promise))(function (resolve, reject) {\\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\\n        function rejected(value) { try { step(generator[\\\"throw\\\"](value)); } catch (e) { reject(e); } }\\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\\n    });\\n};\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nconst aptDependencies_1 = require(\\\"../aptDependencies\\\");\\naptDependencies_1.addAptDependencies('cockpit');\\nfunction setupCockpit() {\\n    return __awaiter(this, void 0, void 0, function* () {\\n        // TODO: Setup user password\\n        // TODO: configure to work with nginx?\\n    });\\n}\\nexports.setupCockpit = setupCockpit;\\n\",\"__webpack_require__.nmd = function(module) {\\n\\tmodule.paths = [];\\n\\tif (!module.children) module.children = [];\\n\\tObject.defineProperty(module, 'loaded', {\\n\\t\\tenumerable: true,\\n\\t\\tget: function() { return module.l; }\\n\\t});\\n\\tObject.defineProperty(module, 'id', {\\n\\t\\tenumerable: true,\\n\\t\\tget: function() { return module.i; }\\n\\t});\\n\\treturn module;\\n};\"]}"